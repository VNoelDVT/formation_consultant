<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultant Coach AI - Formation PRINCE2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f0f23;
            --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --accent-blue: #4285f4;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --border-color: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-tertiary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 24px;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .logo:hover {
            opacity: 0.8;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            font-weight: 600;
            font-size: 18px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .new-chat-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 24px;
        }

        .new-chat-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-purple);
            transform: translateY(-2px);
        }

        .sidebar-section {
            margin-bottom: 16px;
        }

        .sidebar-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            padding: 8px 16px;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .history-item:hover,
        .history-item.active {
            background: var(--glass-bg);
            color: var(--text-primary);
        }

        .history-item.active {
            border-left: 3px solid var(--accent-purple);
        }

        .history-icon {
            font-size: 16px;
            opacity: 0.7;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #f093fb, #f5576c);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        .user-plan {
            font-size: 11px;
            color: var(--accent-purple);
        }

        /* Main Content */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 32px;
            border-bottom: 1px solid var(--border-color);
        }

        .header-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            padding: 8px 16px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* Chat Area */
        .chat-container {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            padding: 32px;
            display: flex;
            flex-direction: column;
        }

        /* Welcome Screen */
        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .welcome-icon {
            width: 80px;
            height: 80px;
            background: var(--accent-gradient);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin-bottom: 24px;
            box-shadow: 0 20px 60px rgba(168, 85, 247, 0.3);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .welcome-title {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 16px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 500px;
            line-height: 1.6;
            margin-bottom: 48px;
        }

        .suggestion-chips {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 700px;
        }

        .suggestion-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px 24px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: var(--text-primary);
        }

        .suggestion-chip:hover {
            background: rgba(168, 85, 247, 0.15);
            border-color: var(--accent-purple);
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(168, 85, 247, 0.2);
        }

        .chip-icon {
            font-size: 20px;
        }

        /* Messages */
        .messages {
            display: none;
            flex-direction: column;
            gap: 24px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        .messages.active {
            display: flex;
        }

        .message {
            display: flex;
            gap: 16px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .message.assistant .message-avatar {
            background: var(--accent-gradient);
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }

        .message-content {
            flex: 1;
            max-width: 80%;
        }

        .message.user .message-content {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .message-bubble {
            padding: 16px 20px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.6;
        }

        .message.assistant .message-bubble {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-top-left-radius: 4px;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-top-right-radius: 4px;
        }

        /* Quiz Card */
        .quiz-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 32px;
            margin-top: 16px;
            backdrop-filter: blur(10px);
        }

        .quiz-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .quiz-icon {
            width: 48px;
            height: 48px;
            background: var(--accent-gradient);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .quiz-title {
            font-size: 20px;
            font-weight: 600;
        }

        .quiz-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .quiz-progress {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .progress-bar {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-gradient);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .question-number {
            display: inline-block;
            padding: 4px 12px;
            background: var(--accent-gradient);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .question-text {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .answer-option:hover {
            background: rgba(168, 85, 247, 0.1);
            border-color: rgba(168, 85, 247, 0.3);
        }

        .answer-option.selected {
            background: rgba(168, 85, 247, 0.15);
            border-color: var(--accent-purple);
        }

        .answer-option.correct {
            background: rgba(34, 197, 94, 0.15);
            border-color: #22c55e;
        }

        .answer-option.incorrect {
            background: rgba(239, 68, 68, 0.15);
            border-color: #ef4444;
        }

        .answer-radio {
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-muted);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .answer-option.selected .answer-radio {
            border-color: var(--accent-purple);
            background: var(--accent-purple);
        }

        .answer-option.selected .answer-radio::after {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        .quiz-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        .quiz-btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .quiz-btn.primary {
            background: var(--accent-gradient);
            color: white;
        }

        .quiz-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(168, 85, 247, 0.3);
        }

        .quiz-btn.secondary {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
        }

        /* Result Card */
        .result-card {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(168, 85, 247, 0.1));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 24px;
            padding: 32px;
            text-align: center;
        }

        .result-score {
            font-size: 64px;
            font-weight: 700;
            background: linear-gradient(135deg, #22c55e, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .result-label {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .result-summary {
            text-align: left;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 24px;
            margin-top: 24px;
        }

        .result-summary h4 {
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-summary p {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.7;
        }

        /* Input Area */
        .input-area {
            padding: 24px 32px;
            border-top: 1px solid var(--border-color);
        }

        .input-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 8px 8px 8px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }

        .input-wrapper:focus-within {
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.1);
        }

        .input-wrapper input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-size: 15px;
            padding: 12px 0;
        }

        .input-wrapper input::placeholder {
            color: var(--text-muted);
        }

        .input-actions {
            display: flex;
            gap: 4px;
        }

        .input-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 18px;
        }

        .input-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .send-btn {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            border: none;
            background: var(--accent-gradient);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 20px;
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 40px rgba(168, 85, 247, 0.3);
        }

        /* Typing Indicator */
        .chip-badge {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 16px 20px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            border-top-left-radius: 4px;
            width: fit-content;
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-purple);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {

            0%,
            80%,
            100% {
                transform: scale(1);
                opacity: 0.5;
            }

            40% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo" onclick="resetToWelcome()">
            <div class="logo-icon">üöÄ</div>
            <span class="logo-text">Devoteam Coach</span>
        </div>

        <button class="new-chat-btn" onclick="resetToWelcome()">
            <span>‚ú®</span>
            <span>Nouvelle session</span>
        </button>

        <div class="sidebar-section auth-only" style="display:none">
            <div class="sidebar-section-title">Aujourd'hui</div>
            <div class="history-item active">
                <span class="history-icon">üìù</span>
                <span>Quiz PRINCE2 - 5 questions</span>
            </div>
        </div>

        <div class="sidebar-section auth-only" style="display:none">
            <div class="sidebar-section-title">Hier</div>
            <div class="history-item">
                <span class="history-icon">üìä</span>
                <span>R√©vision gestion des risques</span>
            </div>
            <div class="history-item">
                <span class="history-icon">üìö</span>
                <span>Principes PRINCE2</span>
            </div>
        </div>

        <div class="sidebar-section auth-only" style="display:none">
            <div class="sidebar-section-title">7 derniers jours</div>
            <div class="history-item">
                <span class="history-icon">üéØ</span>
                <span>Examen blanc complet</span>
            </div>
            <div class="history-item">
                <span class="history-icon">üìã</span>
                <span>Th√®mes PRINCE2</span>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="user-badge" id="sidebarUserBadge" style="opacity:0.7">
                <div class="user-avatar" id="sidebarAvatar" style="background:#334155;color:#94a3b8">?</div>
                <div class="user-info">
                    <div class="user-name" id="sidebarName">Invit√©</div>
                    <div class="user-plan" id="sidebarStatus">Connexion requise</div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
        <header class="header">
            <div class="header-title">Formation PRINCE2 Practitioner</div>
            <div class="header-actions">
                <button class="header-btn">üìä Mes statistiques</button>
                <button class="header-btn">‚öôÔ∏è Param√®tres</button>
            </div>
        </header>

        <div class="chat-container">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-icon">üéì</div>
                <h1 class="welcome-title" id="welcomeTitle">Bienvenue sur Devoteam Coach</h1>
                <p class="welcome-subtitle" id="welcomeSubtitle">
                    Connectez-vous pour acc√©der √† vos parcours.
                </p>

                <button id="initialLoginBtn" onclick="handleInitialLogin()"
                    style="background:white;color:#333;border:none;padding:12px 24px;border-radius:24px;font-weight:600;display:flex;align-items:center;gap:12px;cursor:pointer;font-size:15px;box-shadow:0 4px 12px rgba(0,0,0,0.2);margin-top:20px;transition:all 0.2s;"
                    onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <img src="https://www.google.com/favicon.ico" style="width:20px;height:20px;">
                    Se connecter avec Google
                </button>

                <!-- Cert Selection -->
                <div class="suggestion-chips" id="certChips" style="display:none;margin-top:24px;">
                    <div class="suggestion-chip" onclick="selectCert('PRINCE2')">
                        <span class="chip-badge"
                            style="background:linear-gradient(135deg, #fbbf24, #d97706);color:#fff;">P2</span>
                        <span>PRINCE2 Foundation</span>
                    </div>
                    <div class="suggestion-chip" onclick="selectCert('PMP')">
                        <span class="chip-badge"
                            style="background:linear-gradient(135deg, #3b82f6, #1d4ed8);color:#fff;">PMP</span>
                        <span>PMP Certification</span>
                    </div>
                    <div class="suggestion-chip" style="opacity:0.5;cursor:not-allowed;">
                        <span class="chip-badge"
                            style="border:1px solid var(--text-muted);color:var(--text-muted);">‚è±Ô∏è</span>
                        <span>PSM I (Bient√¥t)</span>
                    </div>
                </div>

                <!-- Mode Selection (Hidden) -->
                <div class="suggestion-chips" id="modeChips" style="display:none;"></div>

                <button id="backToCerts" onclick="showCertSelection()"
                    style="display:none;margin:20px auto 0;background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:13px;padding:8px 16px;border-radius:20px;border:1px solid rgba(255,255,255,0.1);">‚Üê
                    Changer de certification</button>
            </div>

            <!-- Messages Container -->
            <div class="messages" id="messagesContainer">
                <!-- Messages will be injected here -->
            </div>
        </div>

        <div class="input-area">
            <div class="input-container">
                <div class="input-wrapper">
                    <input type="text" placeholder="Posez une question sur PRINCE2..." id="messageInput"
                        onkeypress="handleKeyPress(event)">
                    <div class="input-actions">
                        <button class="input-action-btn">üìé</button>
                        <button class="input-action-btn">üé§</button>
                    </div>
                </div>
                <button class="send-btn" onclick="startQuiz()">‚û§</button>
            </div>
        </div>
    </main>

    <script>
        const quizData = {
            'PRINCE2': [
                {
                    question: "Quel est le r√¥le principal du Comit√© de Pilotage Projet dans PRINCE2 ?",
                    answers: ["A. G√©rer le travail quotidien du projet", "B. Fournir une direction et prendre des d√©cisions cl√©s", "C. Cr√©er les produits du projet", "D. Planifier les √©tapes du projet"],
                    correct: 1,
                    exercise: {
                        icon: 'üë•',
                        title: 'Fiche : Le Comit√© de Pilotage',
                        desc: 'R√¥les et Responsabilit√©s (Th√®me Organisation)',
                        content: `<p><strong>Le Comit√© de Pilotage</strong> est responsable de la r√©ussite du projet. Il ne g√®re pas le quotidien (r√¥le du Chef de Projet) mais prend les d√©cisions cl√©s.</p><div style="background:rgba(168,85,247,0.1);padding:12px;border-radius:8px;margin:12px 0;border-left:4px solid var(--accent-purple);"><strong>Point Cl√© :</strong> Il repr√©sente 3 int√©r√™ts : Business (Ex√©cutif), Utilisateur, et Fournisseur.</div>`
                    }
                },
                {
                    question: "Combien de principes PRINCE2 existe-t-il ?",
                    answers: ["A. 5 principes", "B. 6 principes", "C. 7 principes", "D. 8 principes"],
                    correct: 2,
                    exercise: {
                        icon: 'üìú',
                        title: 'Lecture : Les 7 Principes',
                        desc: 'Les fondements de la m√©thodologie',
                        content: `<p>PRINCE2 est bas√© sur <strong>7 Principes</strong> universels. Si un projet ne respecte pas ces principes, ce n'est pas un projet PRINCE2.</p><ul style="margin:12px 0 12px 20px;line-height:1.6;"><li>Justification continue pour l'entreprise</li><li>Le√ßons tir√©es de l'exp√©rience</li><li>R√¥les et responsabilit√©s d√©finis</li><li>Management par s√©quences</li><li>Management par exception</li><li>Focalisation sur le produit</li><li>Adaptation √† l'environnement projet</li></ul>`
                    }
                },
                {
                    question: "Quel document d√©finit ce qui doit √™tre livr√©, son niveau de qualit√©, et les responsabilit√©s ?",
                    answers: ["A. Le Plan de Projet", "B. Le Cas d'Affaire", "C. La Description de Produit", "D. Le Registre des Risques"],
                    correct: 2,
                    exercise: {
                        icon: 'üìù',
                        title: 'Quiz : La Qualit√©',
                        desc: 'Description de Produit vs Plan',
                        content: `<p><strong>La Description de Produit</strong> est au c≈ìur de l'approche "Focalisation sur le Produit". Elle est cr√©√©e lors de la planification.</p><p>Elle d√©finit les crit√®res de qualit√© que le produit doit respecter pour √™tre accept√©. C'est le "Ce que nous devons livrer" avant le "Comment".</p>`
                    }
                },
                {
                    question: "Quel th√®me PRINCE2 s'assure que le projet reste justifiable ?",
                    answers: ["A. Organisation", "B. Qualit√©", "C. Cas d'Affaire", "D. Risques"],
                    correct: 2,
                    exercise: {
                        icon: 'üìñ',
                        title: 'Lecture : Cas d\'Affaire',
                        desc: 'La justification continue (Th√®me Business Case)',
                        content: `<p><strong>Le Cas d'Affaire</strong> (Business Case) est le moteur du projet. Il justifie pourquoi le travail est entrepris.</p><div style="background:rgba(34,197,94,0.1);padding:12px;border-radius:8px;margin:12px 0;border-left:4px solid #22c55e;"><strong>R√®gle d'Or :</strong> Un projet PRINCE2 doit avoir une justification valide au d√©but, qui reste valide pendant le projet, et qui est confirm√©e √† la fin.</div>`
                    }
                },
                {
                    question: "Dans quelle phase le Chef de Projet pr√©pare-t-il le Plan de Projet ?",
                    answers: ["A. D√©marrer le Projet", "B. Initialiser le Projet", "C. Contr√¥ler une S√©quence", "D. G√©rer la Livraison des Produits"],
                    correct: 1,
                    exercise: {
                        icon: 'üìÖ',
                        title: 'Fiche : Initialiser le Projet',
                        desc: 'Processus IP vs DP',
                        content: `<p>Le <strong>Plan de Projet</strong> est cr√©√© durant le processus "Initialiser le Projet" (IP). C'est la premi√®re vraie s√©quence du projet.</p><p>Ne pas confondre avec "D√©marrer le Projet" (SU) o√π l'on cr√©e seulement un plan pour la s√©quence d'initialisation.</p>`
                    }
                }
            ],
            'PMP': [
                {
                    question: "Quel document autorise formellement l'existence d'un projet ?",
                    answers: ["A. Le Plan de Management de Projet", "B. La Charte du Projet", "C. L'√ânonc√© du Contrat", "D. Le Business Case"],
                    correct: 1,
                    exercise: {
                        icon: 'üìò',
                        title: 'Lecture : La Charte',
                        desc: 'Processus d\'Initialisation (4.1)',
                        content: `<p><strong>La Charte du Projet</strong> (Project Charter) autorise formellement le projet et donne autorit√© au Chef de Projet.</p><div style="background:rgba(59,130,246,0.1);padding:12px;border-radius:8px;margin:12px 0;border-left:4px solid #3b82f6;"><strong>PMBOK 4.1 :</strong> Elle est sign√©e par le Sponsor. C'est le point de d√©part de l'int√©gration.</div>`
                    }
                },
                {
                    question: "Dans la gestion de la valeur acquise, que signifie un CPI < 1.0 ?",
                    answers: ["A. Le projet est en avance sur le planning", "B. Le projet est en retard", "C. Le projet d√©passe le budget", "D. Le projet est sous le budget"],
                    correct: 2,
                    exercise: {
                        icon: 'üìä',
                        title: 'Exercice : EVM (KPIs)',
                        desc: 'Comprendre CPI et SPI',
                        content: `<p><strong>CPI (Cost Performance Index)</strong> mesure l'efficacit√© financi√®re.</p><ul><li>CPI = EV / AC</li><li>CPI < 1 : Vous d√©pensez plus que pr√©vu (Mauvais).</li><li>CPI > 1 : Vous d√©pensez moins que pr√©vu (Bon).</li></ul><p>Ne pas confondre avec SPI (Schedule Performance Index) qui concerne le planning.</p>`
                    }
                },
                {
                    question: "Quelle structure organisationnelle donne le plus de pouvoir au Chef de Projet ?",
                    answers: ["A. Matricielle Faible", "B. Projet√©e (Projectized)", "C. Fonctionnelle", "D. Matricielle Forte"],
                    correct: 1,
                    exercise: {
                        icon: 'üè¢',
                        title: 'Fiche : Structures',
                        desc: 'Matricielle vs Projet√©e',
                        content: `<p>Dans une structure <strong>Projet√©e</strong>, le Chef de Projet a l'autorit√© totale (High to Ultimate). L'√©quipe lui est d√©di√©e.</p><p>Dans une structure <strong>Fonctionnelle</strong>, il a peu ou pas de pouvoir (Little or None).</p>`
                    }
                },
                {
                    question: "Quel est le but principal du processus 'Maitriser la qualit√©' ?",
                    answers: ["A. Auditer les exigences de qualit√©", "B. V√©rifier que les livrables sont corrects", "C. Cr√©er le plan de gestion de la qualit√©", "D. Am√©liorer les processus"],
                    correct: 1,
                    exercise: {
                        icon: '‚úÖ',
                        title: 'Lecture : Qualit√©',
                        desc: 'Assurance vs Contr√¥le',
                        content: `<p><strong>Maitriser la Qualit√©</strong> (Control Quality) se concentre sur les <strong>livrables</strong> (V√©rifier qu'ils sont corrects).</p><p>G√©rer la Qualit√© (Manage Quality) se concentre sur les <strong>processus</strong> (Audits, am√©lioration continue).</p>`
                    }
                },
                {
                    question: "Qui est responsable de la gestion des parties prenantes ?",
                    answers: ["A. Le Sponsor", "B. L'√âquipe Projet", "C. Le Chef de Projet", "D. Le Client"],
                    correct: 2,
                    exercise: {
                        icon: 'ü§ù',
                        title: 'Quiz : Parties Prenantes',
                        desc: 'Engagement et Communication',
                        content: `<p>Le <strong>Chef de Projet</strong> est responsable ultime de l'engagement des parties prenantes. Il doit identifier, planifier, g√©rer et contr√¥ler leur engagement tout au long du projet.</p>`
                    }
                }
            ]
        };

        let questions = quizData['PRINCE2']; // Default
        let currentCertification = '';
        let currentQuestion = 0;
        let userAnswers = [];
        let isLoggedIn = false;

        function handleInitialLogin() {
            const btn = document.getElementById('initialLoginBtn');
            // Simulate processing
            btn.innerHTML = '<div class="typing-dots" style="display:inline-flex;gap:4px;"><div class="typing-dot" style="background:#333"></div><div class="typing-dot" style="background:#333"></div><div class="typing-dot" style="background:#333"></div></div> Connexion...';

            setTimeout(() => {
                // Determine Greeting
                const now = new Date();
                const hrs = now.getHours();
                let greet = "Bonjour";
                if (hrs >= 12 && hrs < 14) greet = "Bon app√©tit";
                else if (hrs >= 18) greet = "Bonsoir";

                // Update Welcome
                const title = document.getElementById('welcomeTitle');
                title.style.opacity = '0';
                setTimeout(() => {
                    title.textContent = `${greet} Valentin !`;
                    title.style.opacity = '1';
                }, 300);

                const subtitle = document.getElementById('welcomeSubtitle');
                subtitle.style.opacity = '0';
                setTimeout(() => {
                    subtitle.textContent = "S√©lectionnez votre parcours de certification.";
                    subtitle.style.opacity = '1';
                }, 300);

                // Hide Btn, Show Chips
                btn.style.opacity = '0';
                setTimeout(() => {
                    btn.style.display = 'none';
                    const chips = document.getElementById('certChips');
                    chips.style.display = 'flex';
                    chips.style.opacity = '0';
                    setTimeout(() => chips.style.opacity = '1', 50);
                    chips.style.transition = 'opacity 0.5s ease';
                }, 500);

                // Update Sidebar smoothly
                document.getElementById('sidebarName').textContent = "Valentin No√´l";
                document.getElementById('sidebarStatus').textContent = "Devoteam Premium";
                const avatar = document.getElementById('sidebarAvatar');
                avatar.textContent = "VN";
                avatar.style.background = "linear-gradient(135deg, #f093fb, #f5576c)";
                avatar.style.color = "white";
                document.getElementById('sidebarUserBadge').style.opacity = "1";

                // Show History
                document.querySelectorAll('.auth-only').forEach(el => el.style.display = 'block');
                isLoggedIn = true;

            }, 1200);
        }

        function selectCert(cert) {
            currentCertification = cert;
            document.getElementById('welcomeTitle').textContent = `Formation ${cert}`;
            document.getElementById('welcomeSubtitle').textContent = "Choisissez votre mode d'entra√Ænement";

            document.getElementById('certChips').style.display = 'none';
            const modeContainer = document.getElementById('modeChips');

            // Dynamic modes based on Cert (Future proofing)
            const modes = [
                { icon: '‚ö°', label: 'Quiz Rapide (5 questions)', action: 'startQuiz(true)' },
                { icon: 'üéØ', label: 'Examen Blanc (1h)', action: 'startQuiz(true)' },
                { icon: 'üìñ', label: 'R√©vision par Th√®me', action: 'startQuiz(true)' }
            ];

            modeContainer.innerHTML = modes.map(m => `
                <div class="suggestion-chip" onclick="${m.action}">
                    <span class="chip-icon">${m.icon}</span>
                    <span>${m.label}</span>
                </div>
            `).join('');

            modeContainer.style.display = 'flex';
            document.getElementById('backToCerts').style.display = 'block';
        }

        function showCertSelection() {
            document.getElementById('welcomeTitle').textContent = "Bonjour Valentin !";
            document.getElementById('welcomeSubtitle').textContent = "S√©lectionnez votre parcours de certification.";
            document.getElementById('certChips').style.display = 'flex';
            document.getElementById('modeChips').style.display = 'none';
            document.getElementById('backToCerts').style.display = 'none';
        }

        function startQuiz(ready) {
            if (!ready) return; // Guard

            if (currentCertification) {
                questions = quizData[currentCertification];
                document.querySelector('.header-title').textContent = `Formation ${currentCertification} ${currentCertification === 'PMP' ? 'Certification' : 'Practitioner'}`;
                userAnswers = [];
                currentQuestion = 0;
            }

            document.getElementById('welcomeScreen').style.display = 'none';
            const container = document.getElementById('messagesContainer');
            container.classList.add('active');
            container.innerHTML = '';

            // User message
            container.innerHTML = `
                <div class="message user">
                    <div class="message-avatar">VN</div>
                    <div class="message-content">
                        <div class="message-bubble">Je voudrais m'entra√Æner sur la certification ${currentCertification}</div>
                    </div>
                </div>
            `;

            // Show typing indicator
            setTimeout(() => {
                container.innerHTML += `
                    <div class="message assistant" id="typingMessage">
                        <div class="message-avatar">üéì</div>
                        <div class="message-content">
                            <div class="typing-indicator active">
                                <span>G√©n√©ration du quiz</span>
                                <div class="typing-dots">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.scrollTop = container.scrollHeight;

                // Show quiz after delay
                setTimeout(() => {
                    document.getElementById('typingMessage').remove();
                    showQuiz();
                }, 1500);
            }, 500);
        }

        function showQuiz() {
            const container = document.getElementById('messagesContainer');

            container.innerHTML += `
                <div class="message assistant">
                    <div class="message-avatar">üéì</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            Parfait ! J'ai pr√©par√© un quiz de 5 questions bas√© sur vos points faibles identifi√©s pr√©c√©demment. Bonne chance ! üçÄ
                        </div>
                        <div class="quiz-card" id="quizCard">
                            <div class="quiz-header">
                                <div class="quiz-icon">üìù</div>
                                <div>
                                    <div class="quiz-title">Quiz ${currentCertification} ${currentCertification === 'PMP' ? 'Certification' : 'Practitioner'}</div>
                                    <div class="quiz-subtitle">5 questions ‚Ä¢ Niveau interm√©diaire</div>
                                </div>
                                <div class="quiz-progress">
                                    <span id="progressText">1/5</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                                    </div>
                                </div>
                            </div>
                            <div id="questionContainer">
                                ${renderQuestion(0)}
                            </div>
                            <div class="quiz-actions">
                                <button class="quiz-btn secondary" onclick="previousQuestion()" id="prevBtn" style="display: none">‚Üê Pr√©c√©dent</button>
                                <button class="quiz-btn primary" onclick="nextQuestion()" id="nextBtn">Suivant ‚Üí</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.scrollTop = container.scrollHeight;
        }

        function renderQuestion(index) {
            const q = questions[index];
            return `
                <div class="question-card">
                    <div class="question-number">Question ${index + 1}</div>
                    <div class="question-text">${q.question}</div>
                    <div class="answer-options">
                        ${q.answers.map((ans, i) => `
                            <div class="answer-option ${userAnswers[index] === i ? 'selected' : ''}" onclick="selectAnswer(${index}, ${i})">
                                <div class="answer-radio"></div>
                                <span>${ans}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function selectAnswer(questionIndex, answerIndex) {
            userAnswers[questionIndex] = answerIndex;
            document.getElementById('questionContainer').innerHTML = renderQuestion(questionIndex);
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                document.getElementById('questionContainer').innerHTML = renderQuestion(currentQuestion);
                document.getElementById('progressText').textContent = `${currentQuestion + 1}/5`;
                document.getElementById('progressFill').style.width = `${(currentQuestion + 1) * 20}%`;
                document.getElementById('prevBtn').style.display = 'block';

                if (currentQuestion === questions.length - 1) {
                    document.getElementById('nextBtn').textContent = 'Terminer ‚úì';
                    document.getElementById('nextBtn').onclick = showResults;
                }
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                document.getElementById('questionContainer').innerHTML = renderQuestion(currentQuestion);
                document.getElementById('progressText').textContent = `${currentQuestion + 1}/5`;
                document.getElementById('progressFill').style.width = `${(currentQuestion + 1) * 20}%`;
                document.getElementById('nextBtn').textContent = 'Suivant ‚Üí';
                document.getElementById('nextBtn').onclick = nextQuestion;

                if (currentQuestion === 0) {
                    document.getElementById('prevBtn').style.display = 'none';
                }
            }
        }

        function showResults() {
            let score = 0;
            questions.forEach((q, i) => {
                if (userAnswers[i] === q.correct) score++;
            });

            // Dynamic feedback based on score
            const feedbackData = {
                5: { emoji: 'üèÜ', label: 'Excellent !', message: 'F√©licitations ! Vous ma√Ætrisez parfaitement PRINCE2.' },
                4: { emoji: 'üéâ', label: 'Tr√®s bien !', message: 'Excellente performance !' },
                3: { emoji: 'üëç', label: 'Bien !', message: 'Bonne progression ! Revoyez les th√®mes difficiles.' },
                2: { emoji: 'üìö', label: '√Ä am√©liorer', message: 'Concentrez-vous sur les exercices cibl√©s.' },
                1: { emoji: 'üí™', label: 'Courage !', message: 'La r√©vision vous aidera beaucoup.' },
                0: { emoji: 'üéØ', label: 'D√©but du parcours', message: 'Commencez par les exercices de base.' }
            };
            const fb = feedbackData[score];

            // Build detailed breakdown
            let breakdown = '';
            questions.forEach((q, i) => {
                const ok = userAnswers[i] === q.correct;
                const userAns = userAnswers[i] !== undefined ? q.answers[userAnswers[i]] : 'Non r√©pondu';
                breakdown += '<div style="background:' + (ok ? 'rgba(34,197,94,0.1)' : 'rgba(239,68,68,0.1)') + ';border:1px solid ' + (ok ? 'rgba(34,197,94,0.3)' : 'rgba(239,68,68,0.3)') + ';border-radius:12px;padding:14px;margin-bottom:10px;">';
                breakdown += '<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;"><span style="font-size:16px;">' + (ok ? '‚úÖ' : '‚ùå') + '</span><strong style="font-size:12px;color:' + (ok ? '#22c55e' : '#ef4444') + ';">Q' + (i + 1) + '</strong></div>';
                breakdown += '<p style="font-size:12px;color:var(--text-primary);margin-bottom:6px;line-height:1.4;">' + q.question + '</p>';
                breakdown += '<div style="font-size:11px;color:var(--text-secondary);">Votre r√©ponse: <span style="color:' + (ok ? '#22c55e' : '#ef4444') + ';">' + userAns + '</span></div>';
                if (!ok) breakdown += '<div style="font-size:11px;color:var(--text-secondary);">Bonne r√©ponse: <span style="color:#22c55e;">' + q.answers[q.correct] + '</span></div>';
                breakdown += '</div>';
            });

            // Build exercises
            let exercises = '';
            const wrong = questions.filter((q, i) => userAnswers[i] !== q.correct);
            if (wrong.length > 0) {
                exercises = '<div style="margin-top:20px;padding-top:20px;border-top:1px solid var(--border-color);"><h4 style="font-size:15px;margin-bottom:14px;">üéØ Exercices cibl√©s</h4><div style="display:flex;flex-direction:column;gap:10px;">';
                const exTypes = [{ icon: 'üìñ', title: 'Lecture', desc: 'Relire le manuel' }, { icon: 'üéÆ', title: 'Quiz', desc: 'Questions similaires' }, { icon: 'üìù', title: 'Fiche', desc: 'Synth√®se des points cl√©s' }, { icon: 'üîÑ', title: 'Cas pratique', desc: 'Appliquer au projet' }];
                wrong.forEach((q, idx) => {
                    const ex = exTypes[idx % exTypes.length];
                    const qNum = questions.indexOf(q) + 1;
                    exercises += '<div style="background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(168,85,247,0.1));border:1px solid rgba(168,85,247,0.2);border-radius:12px;padding:14px;display:flex;gap:12px;align-items:flex-start;cursor:pointer;" onmouseover="this.style.transform=\'translateX(4px)\'" onmouseout="this.style.transform=\'translateX(0)\'">';
                    exercises += '<div style="width:36px;height:36px;background:var(--accent-gradient);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;">' + ex.icon + '</div>';
                    exercises += '<div><div style="font-weight:600;font-size:13px;margin-bottom:2px;">' + ex.title + '</div><div style="font-size:11px;color:var(--text-secondary);">' + ex.desc + '</div><div style="font-size:10px;color:var(--accent-purple);margin-top:4px;">Question ' + qNum + '</div></div>';
                    exercises += '<span style="margin-left:auto;color:var(--text-muted);">‚Üí</span></div>';
                });
                exercises += '</div></div>';
            } else {
                exercises = '<div style="margin-top:20px;padding:16px;background:linear-gradient(135deg,rgba(34,197,94,0.1),rgba(168,85,247,0.1));border-radius:12px;text-align:center;"><span style="font-size:28px;">üéâ</span><p style="margin-top:6px;color:var(--text-secondary);font-size:13px;">Score parfait ! Aucun exercice n√©cessaire.</p></div>';
            }



            const container = document.getElementById('messagesContainer');

            // Build exercises HTML for single column
            let exercisesHTML = '';
            if (wrong.length > 0) {
                exercisesHTML = '<div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border-color);">' +
                    '<h4 style="font-size:16px;margin-bottom:16px;">üéØ Exercices cibl√©s recommand√©s</h4>' +
                    '<div style="display:flex;flex-direction:column;gap:12px;">' +
                    wrong.map((q) => {
                        const qIndex = questions.indexOf(q);
                        const qNum = qIndex + 1;
                        const ex = q.exercise;

                        return `<div style="background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(168,85,247,0.1));border:1px solid rgba(168,85,247,0.2);border-radius:12px;padding:16px;display:flex;gap:14px;align-items:flex-start;cursor:pointer;transition:transform 0.2s;" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='translateX(0)'" onclick="startExercise(${qIndex})">
                            <div style="width:44px;height:44px;background:var(--accent-gradient);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;">${ex.icon}</div>
                            <div style="flex:1;">
                                <div style="font-weight:600;font-size:15px;margin-bottom:4px;">${ex.title}</div>
                                <div style="font-size:13px;color:var(--text-secondary);line-height:1.5;">${ex.desc}</div>
                                <div style="font-size:12px;color:var(--accent-purple);margin-top:6px;">Bas√© sur Question ${qNum}</div>
                            </div>
                            <span style="color:var(--text-muted);font-size:18px;">‚Üí</span>
                        </div>`;
                    }).join('') +
                    '</div></div>';
            } else {
                exercisesHTML = '<div style="margin-top:24px;padding:24px;background:linear-gradient(135deg,rgba(34,197,94,0.1),rgba(168,85,247,0.1));border-radius:16px;text-align:center;">' +
                    '<span style="font-size:48px;">üéâ</span>' +
                    '<p style="margin-top:12px;color:var(--text-secondary);font-size:15px;">Score parfait ! Aucun exercice de rattrapage n√©cessaire.</p>' +
                    '</div>';
            }

            document.getElementById('quizCard').innerHTML =
                '<div class="result-card" style="max-height:none;">' +
                '<div style="text-align:center;margin-bottom:24px;">' +
                '<div class="result-score">' + score + '/5</div>' +
                '<div class="result-label">' + fb.label + ' ' + fb.emoji + '</div>' +
                '<p style="color:var(--text-secondary);font-size:15px;max-width:500px;margin:12px auto 0;">' + fb.message + '</p>' +
                '<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:20px;">' +
                questions.map((q, i) => '<div style="width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:16px;background:' + (userAnswers[i] === q.correct ? 'linear-gradient(135deg,#22c55e,#16a34a)' : 'linear-gradient(135deg,#ef4444,#dc2626)') + '">' + (i + 1) + '</div>').join('') +
                '</div>' +
                '</div>' +
                '<div class="result-summary"><h4 style="font-size:16px;">üìã D√©tail des r√©ponses</h4>' + breakdown + '</div>' +
                exercisesHTML +
                '</div>';


            // Add follow-up message with clickable action
            setTimeout(() => {
                const existing = document.getElementById('pdfPrompt');
                if (existing) existing.remove();

                container.innerHTML += `
                    <div class="message assistant" id="pdfPrompt">
                        <div class="message-avatar">üéì</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                ${score >= 3 ? 'Bravo !' : 'Courage !'} Voulez-vous sauvegarder votre progression ?<br><br>
                                Je peux g√©n√©rer un <strong>r√©sum√© PDF complet</strong> comparant vos r√©sultats du jour avec votre moyenne globale. üìä
                                <div style="margin-top:12px;display:flex;gap:8px;">
                                    <button onclick="requestLogin(${score})" style="background:var(--accent-gradient);border:none;color:white;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:13px;font-weight:600;">üìÑ G√©n√©rer mon r√©sum√© PDF</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.scrollTop = container.scrollHeight;
            }, 800);
        }

        function startExercise(index) {
            const container = document.getElementById('messagesContainer');
            const q = questions[index];
            const ex = q.exercise;

            // Simple header based on exercise type
            const header = `
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:24px;">
                    <div style="width:40px;height:40px;background:var(--accent-gradient);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;">${ex.icon}</div>
                    <div>
                        <h3 style="font-size:18px;">${ex.title}</h3>
                        <span style="font-size:12px;color:var(--accent-purple);">${ex.desc}</span>
                    </div>
                </div>
            `;

            const contentHTML = `
                <div style="line-height:1.6;color:var(--text-secondary);font-size:14px;background:rgba(255,255,255,0.03);padding:24px;border-radius:16px;">
                    ${ex.content}
                </div>
            `;

            document.getElementById('quizCard').innerHTML = `
                <div class="result-card" style="text-align:left;">
                    ${header}
                    ${contentHTML}
                     <button onclick="showResults()" style="margin-top:24px;background:transparent;border:1px solid var(--border-color);color:white;padding:10px 20px;border-radius:12px;font-weight:500;cursor:pointer;width:100%;">‚Üê Retour aux r√©sultats</button>
                </div>
            `;
            container.scrollTop = container.scrollHeight;
        }

        function requestLogin(score) {
            window.currentScore = score;

            if (isLoggedIn) {
                showPDFGeneration(score);
                return;
            }

            // Simulate Login Modal
            const modal = document.createElement('div');
            modal.id = 'loginModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn 0.3s ease;';
            modal.innerHTML = `
                <div style="background:var(--bg-secondary);padding:32px;border-radius:24px;width:400px;text-align:center;border:1px solid var(--border-color);box-shadow:0 20px 60px rgba(0,0,0,0.5);">
                    <div style="font-size:48px;margin-bottom:16px;">üîê</div>
                    <h3 style="font-size:24px;margin-bottom:12px;">Connexion requise</h3>
                    <p style="color:var(--text-secondary);margin-bottom:24px;font-size:14px;">Connectez-vous pour sauvegarder votre session et acc√©der √† votre historique de progression.</p>
                    
                    <button onclick="simulateLogin('google')" style="width:100%;background:white;color:#333;border:none;padding:12px;border-radius:12px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:12px;cursor:pointer;margin-bottom:12px;transition:transform 0.2s;">
                        <img src="https://www.google.com/favicon.ico" style="width:20px;">
                        Continuer avec Google
                    </button>
                    <button onclick="document.getElementById('loginModal').remove()" style="width:100%;background:transparent;border:none;color:var(--text-muted);font-size:13px;cursor:pointer;">
                        Annuler
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function simulateLogin(type) {
            const modal = document.getElementById('loginModal');
            modal.innerHTML = `
                <div style="background:var(--bg-secondary);padding:32px;border-radius:24px;width:400px;text-align:center;border:1px solid var(--border-color);">
                    <div style="width:40px;height:40px;border:3px solid var(--accent-purple);border-top-color:transparent;border-radius:50%;margin:0 auto 24px;animation:spin 1s linear infinite;"></div>
                    <h3 style="font-size:20px;">Connexion s√©curis√©e...</h3>
                </div>
            `;

            setTimeout(() => {
                modal.remove();
                showPDFGeneration(window.currentScore);
            }, 1500);
        }

        function showPDFGeneration(score) {
            const percentage = Math.round((score / 5) * 100);
            const container = document.getElementById('messagesContainer');
            container.innerHTML += `
                <div class="message assistant">
                    <div class="message-avatar">üéì</div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div style="display:flex;align-items:center;gap:12px;">
                                <div style="width:20px;height:20px;border:2px solid var(--accent-purple);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;"></div>
                                <span>Analyse de votre historique et g√©n√©ration du PDF...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            setTimeout(() => {
                const lastMsg = container.lastElementChild;
                lastMsg.remove();

                container.innerHTML += `
                    <div class="message assistant">
                        <div class="message-avatar">üéì</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                Voici votre rapport de progression ! üìà<br>
                                J'ai compar√© vos r√©sultats d'aujourd'hui avec votre moyenne historique.
                            </div>
                            <div style="margin-top:12px;background:var(--glass-bg);border:1px solid var(--glass-border);border-radius:16px;padding:24px;width:100%;max-width:500px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                                    <h3 style="font-size:16px;font-weight:600;">üìä Rapport de progression</h3>
                                    <span style="font-size:12px;color:var(--accent-purple);background:rgba(168,85,247,0.1);padding:4px 8px;border-radius:8px;">11 D√©c. 2025</span>
                                </div>
                                
                                <div style="display:flex;gap:20px;margin-bottom:24px;">
                                    <div style="flex:1;background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;text-align:center;">
                                        <div style="font-size:12px;color:var(--text-secondary);margin-bottom:4px;">Aujourd'hui</div>
                                        <div style="font-size:24px;font-weight:700;color:var(--text-primary);">${percentage}%</div>
                                        <div style="font-size:11px;color:${percentage >= 65 ? '#22c55e' : '#ef4444'};">${percentage >= 65 ? '‚Üë +5% vs moyenne' : '‚Üì -5% vs moyenne'}</div>
                                    </div>
                                    <div style="flex:1;background:rgba(255,255,255,0.02);border-radius:12px;padding:16px;text-align:center;">
                                        <div style="font-size:12px;color:var(--text-secondary);margin-bottom:4px;">Historique</div>
                                        <div style="font-size:24px;font-weight:700;color:var(--text-primary);">65%</div>
                                        <div style="font-size:11px;color:#22c55e;">Sur 12 sessions</div>
                                    </div>
                                </div>

                                <div style="margin-bottom:20px;">
                                    <div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;">Progression Th√®me : Cas d'Affaire</div>
                                    <div style="height:6px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;">
                                        <div style="width:40%;height:100%;background:#ef4444;"></div>
                                    </div>
                                    <div style="display:flex;justify-content:space-between;margin-top:4px;font-size:10px;color:var(--text-muted);">
                                        <span>Niveau actuel: Faible</span>
                                        <span>Objectif: 75%</span>
                                    </div>
                                </div>

                                <button onclick="generateRealPDF(${score})" style="width:100%;background:var(--accent-gradient);border:none;color:white;padding:12px;border-radius:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;">
                                    <span>üì•</span> T√©l√©charger le PDF complet
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                container.scrollTop = container.scrollHeight;
            }, 2500);
        }

        function generateRealPDF(score) {
            const percentage = Math.round((score / 5) * 100);
            const w = window.open('', '_blank');
            w.document.write(`
                <html>
                <head>
                    <title>Rapport_${currentCertification}_11Dec2025.pdf</title>
                    <style>
                        body { font-family: 'Helvetica', sans-serif; padding: 40px; color: #333; }
                        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #667eea; padding-bottom: 20px; margin-bottom: 40px; }
                        .logo { font-size: 24px; font-weight: bold; color: #667eea; }
                        .stats { display: flex; gap: 40px; margin-bottom: 40px; }
                        .stat-box { background: #f8f9fa; padding: 20px; border-radius: 8px; flex: 1; text-align: center; }
                        .big-number { font-size: 36px; font-weight: bold; color: #333; margin: 10px 0; }
                        h1 { font-size: 24px; margin-bottom: 10px; }
                        h2 { font-size: 18px; color: #666; margin-bottom: 20px; margin-top: 40px;}
                        .footer { margin-top: 60px; font-size: 12px; color: #999; text-align: center; border-top: 1px solid #eee; padding-top: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="logo">Devoteam Coach üöÄ</div>
                        <div>Rapport de Formation ${currentCertification}</div>
                    </div>
                    
                    <h1>Rapport de Progression</h1>
                    <p>Date: 11 D√©cembre 2025</p>
                    <p>Apprenant: Valentin (Google Auth)</p>

                    <h2>Synth√®se de la session</h2>
                    <div class="stats">
                        <div class="stat-box">
                            <div>Score Session</div>
                            <div class="big-number">${score}/5</div>
                            <div>${percentage}% R√©ussite</div>
                        </div>
                        <div class="stat-box">
                            <div>Moyenne Globale</div>
                            <div class="big-number">65%</div>
                            <div>Sur 12 sessions</div>
                        </div>
                    </div>

                    <h2>D√©tail des comp√©tences</h2>
                    <div style="margin-bottom:20px;">
                        ${currentCertification === 'PMP' ?
                    `<p><strong>Points forts :</strong> Gestion du p√©rim√®tre, Parties prenantes.</p>
                             <p><strong>Points d'attention :</strong> Processus d'Initialisation (Charte).</p>` :
                    `<p><strong>Points forts :</strong> Principes, Gestion par S√©quence.</p>
                             <p><strong>Points d'attention :</strong> Cas d'Affaire (Justification Continue).</p>`
                }
                    </div>
                    
                    <div style="margin-top:20px;padding:15px;background:#fff3cd;border:1px solid #ffeeba;border-radius:4px;color:#856404;">
                        <strong>Recommandation IA :</strong> 
                        ${currentCertification === 'PMP' ?
                    'Relire le chapitre sur l\'int√©gration et la Charte Projet (4.1) avant l\'examen PMP.' :
                    'Une r√©vision approfondie du th√®me Cas d\'Affaire est recommand√©e avant l\'examen blanc.'
                }
                    </div>

                    <div class="footer">
                        G√©n√©r√© par Devoteam Coach AI ‚Ä¢ Formation Certifiante ${currentCertification}
                    </div>
                </body>
                </html>
            `);
            w.document.close();
            w.print();
        }


        // Add spin animation
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            .auth-only { display: none; } /* Initially hide auth-only sections */
        `;
        document.head.appendChild(styleSheet);


        function resetToWelcome() {
            currentQuestion = 0;
            userAnswers = [];
            document.getElementById('welcomeScreen').style.display = 'flex';
            document.getElementById('messagesContainer').classList.remove('active');
            document.getElementById('messagesContainer').innerHTML = '';
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                startQuiz();
            }
        }
    </script>
</body>

</html>